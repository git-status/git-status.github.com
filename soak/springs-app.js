var springs=[ {"SpringName": "Dexter Spring", "Latitude": "37.294", "TempF": "68\u00b0", "Longitude": "105.784"}, {"SpringName": "Shaw Springs", "Latitude": "37.751", "TempF": "86\u00b0", "Longitude": "106.317"}, {"SpringName": "Wagon Wheel Gap Hot Springs", "Latitude": "37.747", "TempF": "135\u00b0", "Longitude": "106.831"}, {"SpringName": "Rainbow Hot Springs", "Latitude": "37.511", "TempF": "104\u00b0", "Longitude": "106.945"}, {"SpringName": "Stinking Springs", "Latitude": "37.033", "TempF": "81\u00b0", "Longitude": "106.805"}, {"SpringName": "Antelope Spring", "Latitude": "37.741", "TempF": "90\u00b0", "Longitude": "107.034"}, {"SpringName": "Birdsie Warm Spring", "Latitude": "37.728", "TempF": "86\u00b0", "Longitude": "107.054"}, {"SpringName": "Pinkerton Hot Springs", "Latitude": "37.453", "TempF": "90\u00b0", "Longitude": "107.803"}, {"SpringName": "Tripp Hot Springs", "Latitude": "37.4", "TempF": "111\u00b0", "Longitude": "107.849"}, {"SpringName": "Rice Spring, Ward Spring", "Latitude": "37.391", "TempF": "97\u00b0", "Longitude": "107.846"}, {"SpringName": "Piedra River Hot Springs", "Latitude": "37.313", "TempF": "108\u00b0", "Longitude": "107.344"}, {"SpringName": "Pagosa Springs", "Latitude": "37.263", "TempF": "136\u00b0", "Longitude": "107.011"}, {"SpringName": "Dunton Hot Spring", "Latitude": "37.771", "TempF": "108\u00b0", "Longitude": "108.091"}, {"SpringName": "Paradise Warm Spring", "Latitude": "37.752", "TempF": "115\u00b0", "Longitude": "108.131"}, {"SpringName": "Geyser Warm Spring", "Latitude": "37.747", "TempF": "82\u00b0", "Longitude": "108.117"}, {"SpringName": "Wellsville Warm Spring", "Latitude": "38.485", "TempF": "91\u00b0", "Longitude": "105.91"}, {"SpringName": "Swissvale Warm Springs", "Latitude": "38.479", "TempF": "82\u00b0", "Longitude": "105.891"}, {"SpringName": "Canon City Hot Springs", "Latitude": "38.433", "TempF": "104\u00b0", "Longitude": "105.261"}, {"SpringName": "Valley View Hot Springs", "Latitude": "38.192", "TempF": "99\u00b0", "Longitude": "105.816"}, {"SpringName": "Mineral Hot Springs", "Latitude": "38.168", "TempF": "140\u00b0", "Longitude": "105.924"}, {"SpringName": "Cement Creek Hot Spring", "Latitude": "38.836", "TempF": "77\u00b0", "Longitude": "106.825"}, {"SpringName": "Ranger Hot Spring", "Latitude": "38.816", "TempF": "81\u00b0", "Longitude": "106.873"}, {"SpringName": "Cottonwood Hot Springs", "Latitude": "38.812", "TempF": "136\u00b0", "Longitude": "106.226"}, {"SpringName": "Mount Princeton Hot Springs", "Latitude": "38.733", "TempF": "133\u00b0", "Longitude": "106.162"}, {"SpringName": "Hortense Hot Spring", "Latitude": "38.732", "TempF": "181\u00b0", "Longitude": "106.178"}, {"SpringName": "Browns Canyon Warm Spring", "Latitude": "38.653", "TempF": "77\u00b0", "Longitude": "106.056"}, {"SpringName": "Browns Grotto Warm Spring", "Latitude": "38.634", "TempF": "73\u00b0", "Longitude": "106.072"}, {"SpringName": "Lower Waunita Hot Springs", "Latitude": "38.517", "TempF": "167\u00b0", "Longitude": "106.515"}, {"SpringName": "Upper Waunita Hot Springs", "Latitude": "38.514", "TempF": "176\u00b0", "Longitude": "106.508"}, {"SpringName": "Poncha (Salida Pool) Hot Springs", "Latitude": "38.498", "TempF": "160\u00b0", "Longitude": "106.076"}, {"SpringName": "Cebolla Hot Springs", "Latitude": "38.272", "TempF": "106\u00b0", "Longitude": "107.1"}, {"SpringName": "Orvis Hot Spring", "Latitude": "38.133", "TempF": "126\u00b0", "Longitude": "107.736"}, {"SpringName": "Ouray Hot Springs", "Latitude": "38.021", "TempF": "156\u00b0", "Longitude": "107.672"}, {"SpringName": "Lemon Hot Spring", "Latitude": "38.014", "TempF": "91\u00b0", "Longitude": "108.054"}, {"SpringName": "El dorado Springs", "Latitude": "39.932", "TempF": "79\u00b0", "Longitude": "105.277"}, {"SpringName": "Idaho Springs", "Latitude": "39.739", "TempF": "115\u00b0", "Longitude": "105.512"}, {"SpringName": "Hartsell Hot Springs", "Latitude": "39.017", "TempF": "126\u00b0", "Longitude": "105.793"}, {"SpringName": "Rhodes Warm Spring", "Latitude": "39.164", "TempF": "75\u00b0", "Longitude": "106.062"}, {"SpringName": "Conundrum Hot Springs", "Latitude": "39.012", "TempF": "100\u00b0", "Longitude": "106.891"}, {"SpringName": "Dotsero Warm Springs", "Latitude": "39.628", "TempF": "90\u00b0", "Longitude": "107.106"}, {"SpringName": "South Canyon Hot Springs", "Latitude": "39.552", "TempF": "118\u00b0", "Longitude": "107.412"}, {"SpringName": "Glenwood Springs", "Latitude": "39.548", "TempF": "124\u00b0", "Longitude": "107.322"}, {"SpringName": "Penny Hot Springs", "Latitude": "39.227", "TempF": "133\u00b0", "Longitude": "107.224"}, {"SpringName": "Routt Hot Springs", "Latitude": "40.559", "TempF": "147\u00b0", "Longitude": "106.849"}, {"SpringName": "Steamboat Springs", "Latitude": "40.483", "TempF": "102\u00b0", "Longitude": "106.827"}, {"SpringName": "Hot Sulphur Springs", "Latitude": "40.073", "TempF": "111\u00b0", "Longitude": "106.113"}, {"SpringName": "Juniper Hot Springs", "Latitude": "40.467", "TempF": "100\u00b0", "Longitude": "107.952"}];

/*var springService = angular.module('springService', ['ngResource']);

springService.factory('SpringService', ['$resource', function ($resource) {
	return $resource(springs, {}, {
		get: {method: 'GET', params: {lodgeId: pageModel.travelInfo.lodgeId}}
	});
}]);*/



var app=angular.module("myApplicationModule",['uiGmapgoogle-maps','ngResource'/*,'springService'*/]);

/*app.config(['uiGmapGoogleMapApiProvider', function (GoogleMapApi) {
  GoogleMapApi.configure({
//    key: 'your api key',
    v: '3.19.4',
    libraries: 'weather,geometry,visualization'
  });
}]);*/

/*app.factory("springs",function(){
	return springs;
});*/

app.factory('springs', function($resource){
    return $resource('http://0.0.0.0:4000/springs.json');
 
});

app.controller('LodgeMapController',['$scope','springs','$log', function($scope,springs,$log) {
	window.LMC=$scope;
	$log.info('$scope.map.rectangle.bounds set');
	/*start provider*/

/*	 GoogleMapApi.then(function(maps) {
    $scope.googleVersion = maps.version;
    maps.visualRefresh = true;

  });*/
	/* end provider shit*/
  $scope.springIdKey='id';

    
  $scope.states=[];
	$scope.springs=[];
  $scope.stateName='colorado';
  $scope.state='Colorado';
  $scope.denver = { center: { latitude: 39.732630, longitude: -104.990264 }, zoom: 8 };
  $scope.selectedStateSprings=[];

  $scope.$watch('stateName', function(newValue) {
      var state=_.find($scope.springs,function(spring){
        return spring.State==$scope.stateName;
      });
      if(state){
        $scope.selectedStateSprings=state.Springs;
        _.each($scope.selectedStateSprings,function(spring,idx){
            $scope.map.springMarkers.push({
             id: idx,
               /* icon: 'bower_components/angular-google-maps/examples/assets/images/blue_marker.png',*/
               icon: '//s3.amazonaws.com/media.ski.com/Challenger/images/lodging-key.png',
                latitude: spring.Latitude,
                longitude: -(spring.Longitude),
                showWindow: false,
                options: {
                  labelContent: spring.SpringName,
                  labelVisible:false,
                  labelClass: "marker-labels"
                },
                custom:spring

            });

        });
      }
   });

  $scope.map = { 
        center: { 
          latitude: $scope.denver.center.latitude, 
          longitude: $scope.denver.center.longitude 
        }, 
        zoom: 5 
    };

    $scope.map.springMarkers=[];

  springs.get(function(result) {
            $scope.springs=result.Results;
            _.each($scope.springs,function(spring){
                $scope.states.push(spring.State);
              });

      _.each($scope.selectedStateSprings,function(spring,idx){
      $scope.map.springMarkers.push({
       id: idx,
         /* icon: 'bower_components/angular-google-maps/examples/assets/images/blue_marker.png',*/
         icon: '//s3.amazonaws.com/media.ski.com/Challenger/images/lodging-key.png',
          latitude: spring.Latitude,
          longitude: -(spring.Longitude),
          showWindow: false,
          options: {
            labelContent: spring.SpringName,
            labelVisible:false,
            labelClass: "marker-labels"
          },
          custom:spring

      });

    });



        });


		$scope.map.springMarkers.forEach( function (marker) {
    marker.onClicked = function () {
      onMarkerClicked(marker);
    };
  });

		$scope.lodgeMarker = {
			id: 007,
			coords: {
				latitude: $scope.denver.center.latitude,
				longitude: $scope.denver.center.longitude
			},
			options: {
				icon: '//s3.amazonaws.com/media.ski.com/Challenger/images/lodging-key.png',
				title: '$scope.lodge.Name'
			}
		};


	/*marker windows*/
var onMarkerClicked = function (marker) {
    marker.showWindow = true;
    $scope.$apply();
    window.alert("Marker: lat: " + marker.latitude + ", lon: " + marker.longitude + " clicked!!")
  };

	     $scope.windowOptions = {
            visible: false
        };

        $scope.onClick = function() {
            $scope.windowOptions.visible = !$scope.windowOptions.visible;
        };

        $scope.closeClick = function() {
            $scope.windowOptions.visible = false;
        };

}]);

  